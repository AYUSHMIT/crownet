#! /bin/sh
#
# usage: runtest [<testfile>...]
# without args, runs all *.test files in the current directory
#

MAKE="make MODE=debug"
#MAKE="make MODE=release"

TESTFILES=$*
if [ "x$TESTFILES" = "x" ]; then TESTFILES='*.test'; fi
if [ ! -d work ];  then mkdir work; fi
rm -rf work/lib
cp -pPR lib work/  
#export NEDPATH=.:../../../src:../../../../simulations
#export NEDPATH=.:/home/mweidner/crownet/veins/examples/veins:/home/mweidner/crownet/veins/src/veins:/home/mweidner/crownet/veins/subprojects/veins_inet/examples/veins_inet:/home/mweidner/crownet/veins/subprojects/veins_inet/examples/veins_inet_pedestrians:/home/mweidner/crownet/veins/subprojects/veins_inet/examples/veins_inet_vadere:/home/mweidner/crownet/veins/subprojects/veins_inet/src/veins_inet:/home/mweidner/crownet/inet4/src:/home/mweidner/crownet/inet4/examples:/home/mweidner/crownet/inet4/tutorials:/home/mweidner/crownet/inet4/showcases:/home/mweidner/crownet/simulation-campaigns/.:/home/mweidner/crownet/simulte/simulations:/home/mweidner/crownet/simulte/src:/home/mweidner/crownet/artery/scenarios/artery:/home/mweidner/crownet/artery/scenarios/car2car-grid:/home/mweidner/crownet/artery/scenarios/gemv2:/home/mweidner/crownet/artery/scenarios/highway-police:/home/mweidner/crownet/artery/scenarios/lte-blackice:/home/mweidner/crownet/artery/scenarios/mt-its2017:/home/mweidner/crownet/artery/scenarios/simulte:/home/mweidner/crownet/artery/scenarios/storyboard:/home/mweidner/crownet/artery/scenarios/testbed:/home/mweidner/crownet/artery/scenarios/transfusion:/home/mweidner/crownet/artery/src/artery:/home/mweidner/crownet/artery/src/traci:/home/mweidner/crownet/crownet/simulations:/home/mweidner/crownet/crownet/src
export NEDPATH=$(exec ../../../scripts/nedpath)

CROWNET_PATH="../../../src/"
CROWNET_INCLUDE="-I$CROWNET_PATH -L$CROWNET_PATH"

INET_PATH="../../../../inet4/src/"
INET_INCLUDE="-I$INET_PATH -L$INET_PATH"

EXTRA_INCLUDES="$CROWNET_INCLUDE $INET_INCLUDE -lINET_dbg -lCROWNET_dbg"
#EXTRA_INCLUDES="$CROWNET_INCLUDE $INET_INCLUDE -lINET -lCROWNET"

opp_test gen $OPT -v $TESTFILES || exit 1
echo
# (cd work; opp_makemake -f --deep --no-deep-includes -I./lib -o work -i ../makefrag $EXTRA_INCLUDES; $MAKE) || exit 1
(cd work; opp_makemake -f --deep --no-deep-includes -I./lib -o work -i ../makefrag $EXTRA_INCLUDES; $MAKE) || exit 1
echo
echo "opp_test run $OPT -p work_dbg -v $TESTFILES"
opp_test run $OPT -p work_dbg -v $TESTFILES || exit 1
echo
echo Results can be found in ./work