# OpenAirInterface experimental testbed setup: simulation scenarios 
#
# Includes the simulation scenarios for 
# L. Wischhof, F. Schaipp, S. Schubaeck, G. Koester, 
# Simulation~vs.~Testbed: Small Scale Experimental Validation of an Open-Source LTE-A Model
#
# For a detailed description of the scenarios, refer to the publication mentioned above.

[General]
image-path=../../images
tkenv-plugin-path = ../../../inet/etc/plugins
#record-eventlog = true
#tkenv-default-config = 
output-scalar-file-append = false
print-undisposed = true

#============= Simulation parameters ================
sim-time-limit=100s #fixme: 300s
warmup-period=0s    
repeat = 3
seed-set = ${repetition}

#============= Mobility parameters ==================
**.mobility.constraintAreaMinZ = 0m
**.mobility.constraintAreaMaxZ = 0m

#============= AMC module parameters ================
# (number of RBs is not included here because it is scenario specific)
**.ueTxPower = 20
**.eNodeBTxPower = 20

#============= Channel control parameters ===========
**.channelControl.pMax = 1W
**.channelControl.alpha = 1.0
**.channelControl.carrierFrequency = 2600e+6Hz

#============= Channel model parameters =============
# for a complete list of all parameters: 
#   refer to LteChannelModels.ned
**.channelModel.shadowing = false   # enable/disable shadowing        
**.channelModel.scenario = "INDOOR_HOTSPOT"  # pathloss scenario from ITU: INDOOR_HOTSPOT, URBAN_MICROCELL, URBAN_MACROCELL, RURAL_MACROCELL, SUBURBAN_MACROCELL
**.channelModel.nodeb_height = 1.5
**.channelModel.ue_height = 1.5
**.channelModel.building_height = 20

**.channelModel.street_wide = 20
**.channelModel.carrierFrequency = 2.6  # carrier frequency (in GHz)
**.channelModel.antennaGainUe = 0
**.channelModel.antennGainEnB = 0

**.channelModel.dynamic_los = false   # If true enable the possibility to switch dinamically the LOS/NLOS pathloss computation
**.channelModel.fixed_los = true      # If dynamic-los is false this parameter, if true, compute LOS pathloss otherwise compute NLOS pathloss
**.channelModel.fading = false        # Enable/disable fading
**.channelModel.fading_type = "JAKES" # Fading type (JAKES or RAYGHLEY) if fading is enabled
**.channelModel.fading_paths = 6      # If jakes fading this parameter specify the number of path (tap channel)
**.channelModel.delay_rms = 363e-9  

**.channelModel.extCell_interference = false # if true, enables the inter-cell interference computation for DL connections from external cells
**.channelModel.downlink_interference = true # if true, enables the inter-cell interference computation for DL connections
**.channelModel.uplink_interference = true   # if true, enables the interference computation for UL connections
**.channelModel.d2d_interference = true      # if true, enables the interference computation for D2D connections

#============= Protocol stack parameters  ===========
#(as in OpenAirInterface Configuration)
**.rlc.um.queueSize = 5000000B              # OpenAirInterface queue limit for RLC_MODE_UM  (Commit f58ad3c39f04ca7305202749a7dad2b25ef6b942 file rlc.c  method rlc_data_req() line 478)
**.mac.queueSize = 10000B					# reduce MAC queue size - OpenAirInterface does not queue packets in mac layer
**.pdcpRrc.backgroundRlc = 1                # default RLC type (0: TM, 1: UM, 2: AM)


#============= Statistics ===========================
output-scalar-file = ${resultdir}/${configname}/${repetition}.sca
output-vector-file = ${resultdir}/${configname}/${repetition}.vec
seed-set = ${repetition}

**.routingRecorder.enabled = false


# *.numUe = ${numUEs=2}

# connect each UE to the eNB
**.ue[*].macCellId = 1
**.ue[*].masterId = 1

#============= Positioning and mobility ============
*.eNB.mobility.initFromDisplayString = true
# *.eNB.mobility.initialX = 0.5m
# *.eNB.mobility.initialY = 1m
# set constrains for area according to size of 
# shielded lab R1.009a
*.ue[*].mobility.constraintAreaMaxX = 7.5m
*.ue[*].mobility.constraintAreaMaxY = 10m
*.ue[*].mobility.constraintAreaMinX = 0m
*.ue[*].mobility.constraintAreaMinY = 0m
*.ue[*].mobility.initFromDisplayString = false
*.ue[*].mobility.initialX = 5m
*.ue[*].mobility.initialY = 2.5m + (ancestorIndex(1)*0.5m)
*.ue[*].mobility.speed = 0mps
*.ue[*].mobilityType = "LinearMobility"
#------------------------------------#


# record relevant statistics
**.alert*.vector-recording = true
# all other vectors are disabled
**.vector-recording = false


################################################  Downlink Scenarios ####################################################


##################################################
# S1-base: low-rate data traffic - base scenario #
##################################################
[Config S1-base]
*.numUe = ${numUEs=1}

*.ue[*].numApps = 1
*.ue[*].app[0].typename = "AlertReceiver"

*.server.numApps = ${numUEs} # applications on server should be equal to (numUEs)*(ue[*].numUdpApps) 
*.server.app[*].destAddress = "ue["+string(ancestorIndex(0))+"]" # obtain the address of the client by reading its index in the array of apps
*.server.app[*].localPort = 3088+ancestorIndex(0) 
*.server.app[*].typename = "AlertSender"
*.server.app[*].multicastInterface = ""  # server runs on a standard host - no need to set mulicastInterface manually
*.server.app[*].packetSize = 300
*.server.app[*].period = truncnormal(0.1s, 1ms)
*.server.app[*].startTime = uniform(0s,0.02s)
*.server.app[*].stopTime = 300.0s

##################################################
# S1: low-rate data traffic (50 RBs)             #
##################################################
[Config S1]
extends=S1-base
network = rover.simulations.networks.LabSingleCellAdaptedRB50
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

##################################################
# S1.UA: low-rate data traffic, unadapted model  #
##################################################
[Config S1-UA]
extends=S1-base
network = rover.simulations.networks.LabSingleCell

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

##################################################
# S1.25: low-rate data traffic, only 25 RBs      #
##################################################
[Config S1-25]
extends=S1-base
network = rover.simulations.networks.LabSingleCellAdaptedRB25
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data

**.numRbDl = 25
**.numRbUl = 25
**.numBands = 25

##################################################
# S1.25: low-rate data traffic, only 25 RBs UA   #
##################################################
[Config S1-25-UA]
extends=S1-base
network = rover.simulations.networks.LabSingleCell

**.numRbDl = 25
**.numRbUl = 25
**.numBands = 25

#######################################################
# SingleCell Lab Configuration	                      #
# - Scenario 1B: Scen. 1 with param. variation:       # 
#   varies the standard-deviation of the alert period #
#   no background traffic                             #
#######################################################
[Config S1-alert-variance]
extends=S1

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

*.server.app[*].period =  truncnormal(0.1s, ${perstddev=0..100 step 1}ms)
output-scalar-file = ${resultdir}/${configname}/perstddev_${perstddev}_${repetition}.sca
output-vector-file = ${resultdir}/${configname}/perstddev_${perstddev}_${repetition}.vec


######################################################
# S2-base: SingleCell Lab Configuration - Overload   #
# - similar to Scenario 2 as measured by             #
#   F. Schaipp (Rep.2) but target of background      #
#   traffic is same UE (OAI uses one RLC UA          #
#   instance for all traffic - see paper for details # 
#   2.94 MB/s background traffic                     #        
######################################################
[Config S2-base]
*.numUe = ${numUEs=1}
*.ue[*].numApps = 2

*.ue[*].app[0].typename = "AlertReceiver"
*.ue[*].app[1].typename = "UdpSink"
*.ue[*].app[1].localPort = 5000

*.server.numApps = ${numUEs} + 1 # one sender application for each UE + background traffic
# background traffic
*.server.app[0].typename = "UdpBasicApp"
*.server.app[0].destAddresses = "ue[0]"
*.server.app[0].sendInterval = truncnormal(60us, 1us) # 60us corresponds to 8.14 MiB/s background traffic
*.server.app[0].destPort = 5000
*.server.app[0].messageLength = 512B
*.server.app[0].packetName = "UDPBackground"

# CAMs
*.server.app[1..].destAddress = "ue[0]"
*.server.app[1..].localPort = 3088 
*.server.app[1..].typename = "AlertSender"
*.server.app[1..].multicastInterface = ""  # server runs on a standard host - no need to set mulicastInterface manually
*.server.app[1..].packetSize = 300
*.server.app[1..].period = truncnormal(0.1s, 1ms)
*.server.app[1..].startTime = uniform(0s,0.02s)
*.server.app[1..].stopTime = 300.0s

[Config S2]
extends=S2-base
network = rover.simulations.networks.LabSingleCellAdaptedRB50
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

[Config S2-UA]
extends=S2-base
network = rover.simulations.networks.LabSingleCell
**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

[Config S2-25]
extends=S2-base
network = rover.simulations.networks.LabSingleCellAdaptedRB25
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data
*.server.app[0].sendInterval = truncnormal(0.17ms, 0.01ms) # 0.17ms corresponds to 2.94 MB/s background traffic 
**.numRbDl = 25
**.numRbUl = 25
**.numBands = 25

[Config S2-25-UA]
extends=S2-base
network = rover.simulations.networks.LabSingleCell
*.server.app[0].sendInterval = truncnormal(0.17ms, 0.1ms) # 0.17ms corresponds to 2.94 MB/s background traffic 
**.numRbDl = 25
**.numRbUl = 25
**.numBands = 25

##################################################
# S3-base: low-rate data traffic - UE1 to UE0    #
##################################################
[Config S3-base]
*.numUe = ${numUEs=2}

*.ue[*].numApps = 1
*.ue[0].app[0].typename = "AlertReceiver"

*.ue[1].app[*].destAddress = "ue[0]"
*.ue[1].app[*].typename = "AlertSender"
*.ue[1].app[*].multicastInterface = ""  # server runs on a standard host - no need to set mulicastInterface manually
*.ue[1].app[*].packetSize = 300
*.ue[1].app[*].period =  truncnormal(0.1s, 0.1ms)
*.ue[1].app[*].startTime = uniform(0s,0.02s)
*.ue[1].app[*].stopTime = 300.0s

##################################################
# S3: low-rate data traffic UE-2-UE              #
##################################################
[Config S3]
extends=S3-base
network = rover.simulations.networks.LabSingleCellAdaptedRB50
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

##################################################
# S3: low-rate data traffic UE-2-UE (UA)         #
##################################################
[Config S3-UA]
extends=S3-base
network = rover.simulations.networks.LabSingleCell
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

########################################################################
# S4-base: low-rate data traffic - UE1 to UE0 in overload condition    #
#          where overload is caused by other background traffic        #
########################################################################
[Config S4-base]
*.numUe = ${numUEs=2}

*.ue[0].numApps = 2
*.ue[0].app[0].typename = "AlertReceiver"
*.ue[0].app[1].typename = "UdpSink"
*.ue[0].app[1].localPort = 5000

# UE 1 sends probe traffic
*.ue[1].numApps = 1
*.ue[1].app[0].destAddress = "ue[0]"
*.ue[1].app[0].typename = "AlertSender"
*.ue[1].app[0].multicastInterface = ""  # server runs on a standard host - no need to set mulicastInterface manually
*.ue[1].app[0].packetSize = 300
*.ue[1].app[0].period =  truncnormal(0.1s, 0.1ms)
*.ue[1].app[0].startTime = uniform(0s,0.02s)
*.ue[1].app[0].stopTime = 300.0s

# background traffic generated on server
*.server.numApps = 1 
*.server.app[0].typename = "UdpBasicApp"
*.server.app[0].destAddresses = "ue[0]"
*.server.app[0].sendInterval = truncnormal(60us, 1us) # 60us corresponds to 8.14 MiB/s background traffic
*.server.app[0].destPort = 5000
*.server.app[0].messageLength = 512B
*.server.app[0].packetName = "UDPBackground"

##################################################
# S4: low-rate data traffic UE-2-UE, overload    #
##################################################
[Config S4]
extends=S4-base
network = rover.simulations.networks.LabSingleCellAdaptedRB50
**.rlc.um.mapAllLcidsToSingleBearer = true  # OpenAirInterface uses a single bearer for all data

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50

##################################################
# S4: low-rate data traffic UE-2-UE, overload    #
##################################################
[Config S4-UA]
extends=S4-base
network = rover.simulations.networks.LabSingleCell

**.numRbDl = 50
**.numRbUl = 50
**.numBands = 50


#### other (currently not used/implemented) configurations: ###

#######################################################
# S2: SingleCell Lab Configuration - Overload         #
# - identical to Scenario 2 as measured by            #
#   F. Schaipp (Rep.2) but results are not comparable #      
#   since OAI has only one RLC queue for all UEs      #
#   (see paper for details)                           #  
#######################################################
# [Config OpenAirInterface-CAM-DL-2-2UE]
# network = rover.simulations.networks.LabSingleCellAdaptedRB50

# **.numRbDl = 50
# **.numRbUl = 50
# **.numBands = 50

# currently not implemented
